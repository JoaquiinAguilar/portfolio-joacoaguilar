<!DOCTYPE html>
<html lang="<%= language %>" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <% if(language === 'en') { %>
            Joaquín Aguilar | Software Engineer
        <% } else { %>
            Joaquín Aguilar | Ingeniero de Software
        <% } %>
    </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/aditional.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="/images/favicon.png" type="image/png">
    <script>
        (function() {
            const html = document.documentElement;
            const savedTheme = localStorage.getItem('theme');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
            let initialTheme = 'light'; // Default to light

            if (savedTheme) {
                initialTheme = savedTheme;
            } else if (prefersDarkScheme.matches) {
                initialTheme = 'dark';
            }

            html.setAttribute('data-theme', initialTheme);

            // Prevent transition flicker on initial load
            const body = document.body;
            if (body) {
                body.style.transition = 'none';
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        body.style.transition = ''; // Restore original transition after a repaint
                    });
                });
            }
        })();
    </script>
    <script src="/js/animation.js" defer></script>
    <script src="/js/spa.js" defer></script>
</head>
<body>
    <div id="loading-overlay">
        <div class="spinner"></div>
    </div>
    <div id="particles-js"></div>
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <a href="/">JA</a>
                </div>
                <div class="nav-links">
                    <a href="/" class="<%= page === 'home' ? 'active' : '' %>">
                        <%= language === 'en' ? 'Home' : 'Inicio' %>
                    </a>
                    <a href="/projects" class="<%= page === 'projects' ? 'active' : '' %>">
                        <%= language === 'en' ? 'Projects' : 'Proyectos' %>
                    </a>
                    <a href="/about" class="<%= page === 'about' ? 'active' : '' %>">
                        <%= language === 'en' ? 'About' : 'Acerca de' %>
                    </a>
                    <a href="/contact" class="<%= page === 'contact' ? 'active' : '' %>">
                        <%= language === 'en' ? 'Contact' : 'Contacto' %>
                    </a>
                </div>
                <div class="nav-controls">
                    <label class="theme-switch" for="theme-toggle-checkbox">
                        <input type="checkbox" id="theme-toggle-checkbox" />
                        <div class="slider round"></div>
                    </label>
                    <div class="language-dropdown-container">
                        <button class="language-display">
                            <%= language === 'en' ? 'EN' : 'ES' %> <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="language-selector">
                            <a href="?lang=en" class="<%= language === 'en' ? 'active' : '' %>">English</a>
                            <a href="?lang=es" class="<%= language === 'es' ? 'active' : '' %>">Español</a>
                        </div>
                    </div>
                </div>
                <button class="mobile-menu-btn" aria-label="Toggle mobile menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </nav>
        </div>
    </header>
    <div class="mobile-menu">
        <a href="/" class="<%= page === 'home' ? 'active' : '' %>">
            <%= language === 'en' ? 'Home' : 'Inicio' %>
        </a>
        <a href="/projects" class="<%= page === 'projects' ? 'active' : '' %>">
            <%= language === 'en' ? 'Projects' : 'Proyectos' %>
        </a>
        <a href="/about" class="<%= page === 'about' ? 'active' : '' %>">
            <%= language === 'en' ? 'About' : 'Acerca de' %>
        </a>
        <a href="/contact" class="<%= page === 'contact' ? 'active' : '' %>">
            <%= language === 'en' ? 'Contact' : 'Contacto' %>
        </a>
        <div class="mobile-controls">
            <label class="theme-switch" for="mobile-theme-toggle-checkbox">
                <input type="checkbox" id="mobile-theme-toggle-checkbox" />
                <div class="slider round"></div>
            </label>
            <div class="language-dropdown-container">
                <button class="language-display">
                    <%= language === 'en' ? 'EN' : 'ES' %> <i class="fas fa-chevron-down"></i>
                </button>
                <div class="language-selector">
                    <a href="?lang=en" class="<%= language === 'en' ? 'active' : '' %>">English</a>
                    <a href="?lang=es" class="<%= language === 'es' ? 'active' : '' %>">Español</a>
                </div>
            </div>
        </div>
    </div>
    <main>